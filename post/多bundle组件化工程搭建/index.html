<!DOCTYPE html>
<html>
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1">
    <title>多bundle组件化工程搭建 - Blog</title>

    <style type="text/css">
        img.wp-smiley,
        img.emoji {
            display: inline !important;
            border: none !important;
            box-shadow: none !important;
            height: 1em !important;
            width: 1em !important;
            margin: 0 .07em !important;
            vertical-align: -0.1em !important;
            background: none !important;
            padding: 0 !important;
        }
    </style>
    <link rel='stylesheet' href='https://shanbozhu.github.io/css/style.css' type='text/css' media='all' />
    <link rel='stylesheet' href='https://shanbozhu.github.io/css/custom.css' type='text/css' media='all' />
        
</head>
    <body class="two-column">
        <a href="#content">Skip to content</a>
<div class="wrapper">
    <header role="banner" class="banner widgets columns-1">
        <a href="/" rel="home">
            <h1 class="site">Blog</h1>
            <p></p>
        </a>
    </header>

    <br>
    <div style="width: 100%; max-height: 100px; text-align: center;">
       
</div>

    <div class="breadcrumbs">
        
    </div>
        <div id="content" class="content">

<main role="main">
    <article role="article" class="post type-post format-standard hentry">
        <header class="post-header">
            <h1>多bundle组件化工程搭建</h1>
            <div class="post-details">
                <a rel="bookmark">
                    <time datetime="2019-05-23T523:536:266">2019-05-23</time>
                </a>
				
<span style="float: right;">
    <div id="fb-root" style="height: 100%;"></div>
    
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.2"></script>
    
    <div class="fb-share-button" data-href="https://shanbozhu.github.io/post/%E5%A4%9Abundle%E7%BB%84%E4%BB%B6%E5%8C%96%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA/" data-layout="button_count" data-size="small">
        <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fshanbozhu.github.io%2fpost%2f%25E5%25A4%259Abundle%25E7%25BB%2584%25E4%25BB%25B6%25E5%258C%2596%25E5%25B7%25A5%25E7%25A8%258B%25E6%2590%25AD%25E5%25BB%25BA%2f" class="fb-xfbml-parse-ignore">Share</a>
    </div>
    &nbsp;
    <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-text="多bundle组件化工程搭建" data-url="https://shanbozhu.github.io/post/%E5%A4%9Abundle%E7%BB%84%E4%BB%B6%E5%8C%96%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA/" data-show-count="false">Tweet</a>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    &nbsp;
    
</span>

            </div>
        </header>

        <div class="post-content">
            

<p>多bundle组件化工程搭建（不依赖摩天轮打包平台）</p>

<h4 id="一-现状">一、现状</h4>

<p>集团内部提供摩天轮打包平台统一打包、部署，每个bundle生成framework的工作都是由平台完成，我们若完全脱离摩天轮平台，怎样利用普通git仓库实现同样功能的多bundle架构呢？下面将要介绍具体操作，虽然功能简陋没有摩天轮强大，但是基本具备多bundle开发能力。</p>

<h4 id="二-原理">二、原理</h4>

<p>多bundle开发可以描述为下图结构，每个bundle单独编译为framework，然后在主工程portal上进行link操作，各bundle只有在个别情况下需要依赖其他bundle，总体来说相互独立，摩天轮做的就是将各bundle后台打包成framework，我们本地通过配置podfile文件使用这些framework。</p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_23/2019_5_23_0.png?raw=true" alt="" /></p>

<p>因此，脱离摩天轮所要做的工作就是：</p>

<ul>
<li>能够根据源码打包出framework并部署到pod仓库</li>
<li>能够通过podfile管理这些framework</li>
</ul>

<h4 id="三-步骤">三、步骤</h4>

<ol>
<li>本地建立PBAPortal主工程和各业务子bundle</li>
</ol>

<ul>
<li>建立PBAPortal主工程</li>
</ul>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_23/2019_5_23_1.png?raw=true" alt="" /></p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_23/2019_5_23_2.png?raw=true" alt="" /></p>

<ul>
<li>建立PBHome子工程</li>
</ul>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_23/2019_5_23_3.png?raw=true" alt="" /></p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_23/2019_5_23_4.png?raw=true" alt="" /></p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_23/2019_5_23_5.png?raw=true" alt="" /></p>

<ol>
<li>找一个git仓库，我在网上使用了<a href="https://coding.net/">https://coding.net/</a>，实际可以使用内网搭建的git仓库，将建立的工程上传到仓库</li>
</ol>

<ul>
<li>上传PBAPortal工程</li>
</ul>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_23/2019_5_23_6.png?raw=true" alt="" /></p>

<ul>
<li>上传PBHome子工程</li>
</ul>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_23/2019_5_23_7.png?raw=true" alt="" /></p>

<ol>
<li>在git仓库上建立一个PBASpec仓库，用于放置spec文件，该仓库和普通存储工程源码的仓库一样操作即可</li>
</ol>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_23/2019_5_23_8.png?raw=true" alt="" /></p>

<p>最终本地目录如下图</p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_23/2019_5_23_9.png?raw=true" alt="" /></p>

<ol>
<li>分别在主工程和子工程内增加podfile文件，利用pod管理每个工程</li>
</ol>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_0.png?raw=true" alt="" /></p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_1.png?raw=true" alt="" /></p>

<p>注意添加图中标注的私有仓库路径，即spec仓库地址</p>

<ol>
<li>编辑子工程对应的spec文件</li>
</ol>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_2.png?raw=true" alt="" /></p>

<p>将PBASpec目录上传至对应git仓库</p>

<ol>
<li>配置子工程脚本文件</li>
</ol>

<p>因为子工程生成的framework位于DerivedData子目录下，spec文件指定的framework需要位于工程根目录下，脚本的作用就是拷贝framework到工程根目录</p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_3.png?raw=true" alt="" /></p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_4.png?raw=true" alt="" /></p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_5.png?raw=true" alt="" /></p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_6.png?raw=true" alt="" /></p>

<p>编译之后会将生成的framework拷贝至根目录</p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_7.png?raw=true" alt="" /></p>

<p>将含有PBHome.framework的工程上传至git仓库</p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_8.png?raw=true" alt="" /></p>

<p>至此在主工程和其他子bundle中就可以通过podfile引入该framework了</p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_9.png?raw=true" alt="" /></p>

<p>主工程执行<code>pod install</code></p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_10.png?raw=true" alt="" /></p>

<ol>
<li>子bundle图片等资源文件的处理</li>
</ol>

<ul>
<li>未联合编译的情况下</li>
</ul>

<p>若只使用PBAPortal工程，framework中的资源文件会被执行<code>pod install</code>后自动生成的脚本文件拷贝到app包中</p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_11.png?raw=true" alt="" /></p>

<p>下图是framework未引入资源文件时脚本文件中的内容</p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_12.png?raw=true" alt="" /></p>

<p>下图是framework引入资源文件时脚本文件中的内容</p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_13.png?raw=true" alt="" /></p>

<p>图中框选部分就是将framework中的资源文件拷贝到app包中</p>

<p>我们在图片调用时只需要写明具体的路径即可</p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_14.png?raw=true" alt="" /></p>

<ul>
<li>联合编译的情况下</li>
</ul>

<p>将子bundle和PBAPortal联合编译，手动拖拽PBHome.xcodeproj至PBAPortal的平级目录</p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_15.png?raw=true" alt="" /></p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_16.png?raw=true" alt="" /></p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_17.png?raw=true" alt="" /></p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_18.png?raw=true" alt="" /></p>

<p>联合编译的情况下PBAPortal工程并不能够自动的获取子bundle中的最新图片，此时需要在PBAPortal手动配置脚本，将子bundle工程中的资源文件通过脚本拷贝到app包中</p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_19.png?raw=true" alt="" /></p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_20.png?raw=true" alt="" /></p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_21.png?raw=true" alt="" /></p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_22.png?raw=true" alt="" /></p>

<p>脚本拷贝资源文件内容如下图</p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_23.png?raw=true" alt="" /></p>

<p>编译过程中输出的拷贝信息如下图</p>

<p><img src="https://github.com/shanbozhu/github.io.resource/blob/master/image/2019_5_24/2019_5_24_24.png?raw=true" alt="" /></p>

<p>至此，整个组件化工程搭建完成，本文只列举了PBHome作为子bundle，可以按照步骤添加任意多个子bundle。</p>

        </div>



        <footer class="post-footer">
                
                
                
        
                
                
                
        </footer>
        
<table cellspacing="15" style="width:100%; border: none;">
    <tr>
        <td style="text-align: center; border: none; padding: 0px;">
        </td>
        <td style="text-align: center; border: none; padding: 0px;">
        </td>
    </tr>
</table>

        
	
	

    </article>

    
    <nav class="navigation post-navigation" role="navigation">
        <div class="nav-links">
            <div class="nav-previous">
                
                <a class="previous" href="https://shanbozhu.github.io/post/test/"> Test</a>
                
            </div>
            <div class="nav-next">
                
                <a class="next" href="https://shanbozhu.github.io/post/universal-links%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AE%9E%E7%8E%B0/"> Universal Links功能的实现</a>
                
            </div>
        </div>
    </nav>
    <section>
        
    </section>
    

</main>


        <div class="sidebar1 widgets columns-1">

    <aside>
    
</aside>
    <aside class="widget widget_categories">
        <h2></h2>
        <ul class="widget__list">
        </ul>
    </aside>

    <aside class="widget widget_tag_cloud">
        <h2></h2>
        <div class="tagcloud">
        </div>
    </aside>

    <aside class="widget widget_recent_entries">
        <h2></h2>
        <ul>
            <li>
                <a href="/post/markdown%E5%B8%B8%E7%94%A8%E5%9B%BE%E8%A1%A8%E8%AF%AD%E6%B3%95/">Markdown常用图表语法</a>
            </li>
            <li>
                <a href="/post/%E8%8B%B9%E6%9E%9C%E5%BC%80%E5%8F%91%E8%80%85%E8%B4%A6%E5%8F%B7%E7%B1%BB%E5%9E%8B/">苹果开发者账号类型</a>
            </li>
            <li>
                <a href="/post/%E5%A4%A7%E5%85%AC%E5%8F%B8%E7%89%B9%E7%82%B9%E6%80%BB%E7%BB%93/">大公司特点总结</a>
            </li>
            <li>
                <a href="/post/universal-links%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AE%9E%E7%8E%B0/">Universal Links功能的实现</a>
            </li>
            <li>
                <a href="/post/%E5%A4%9Abundle%E7%BB%84%E4%BB%B6%E5%8C%96%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA/">多bundle组件化工程搭建</a>
            </li>
            <li>
                <a href="/post/test/">Test</a>
            </li>
            <li>
                <a href="/post/mac%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%85%8D%E7%BD%AE/">Mac命令行配置</a>
            </li>
            <li>
                <a href="/post/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">Git常用命令</a>
            </li>
            <li>
                <a href="/post/ios%E5%B8%B8%E7%94%A8%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/">iOS常用开发工具</a>
            </li>
            <li>
                <a href="/post/%E5%AE%89%E8%A3%85cocoapods/">安装CocoaPods</a>
            </li>
        </ul>
    </aside>

    <aside class="widget widget_archive">
        <h2></h2>
        <ul>
        </ul>
    </aside>

</div>
        </div>
        </div>
<footer role="contentinfo" class="document-footer contentinfo widgets columns-1">

    <aside class="widget widget_text">
        <div class="textwidget">
            <p>© Blog / Powered by <a href="https://gohugo.io" target="_blank">Hugo</a> with theme <a href="https://github.com/tosi29/inkblotty" target="_blank">Inkblotty</a></p>
        </div>
    </aside>
</footer>
</div>

    </body>
</html>
